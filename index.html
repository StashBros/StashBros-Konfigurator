<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StashBros Produkt-Konfigurator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1, h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #f4f4f4;
    }
    .responsive {
      overflow-x: auto;
    }
    .form-group {
      margin: 10px 0;
    }
    label {
      display: block;
      font-weight: bold;
    }
    input[type="number"], button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>StashBros Produkt-Konfigurator</h1>
    <div class="form-group">
      <label for="members">Mitgliederanzahl</label>
      <input type="number" id="members" min="1" placeholder="Geben Sie die Anzahl der Mitglieder ein">
    </div>
    <button onclick="calculate()">Berechnen</button>

    <h2>Produktempfehlungen</h2>
    <div class="responsive">
      <table id="recommendations-table">
        <thead>
          <tr>
            <th>Produkt</th>
            <th>Fassungsgrößen (in Litern)</th>
            <th>Anzahl</th>
            <th>Einzelpreis (€)</th>
            <th>Gesamtkosten (€)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h2>Abo-Optionen</h2>
    <div class="responsive">
      <table id="subscription-table">
        <thead>
          <tr>
            <th>Rabatt</th>
            <th>Rabattierte Gesamtkosten (€)</th>
            <th>Kosten pro Gramm (€)</th>
            <th>Kosten pro Pflanze (€)</th>
            <th>Monatliche Kosten (€)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const productData = {
      coco: { volumes: [0.5, 1, 5, 10, 20], prices: [5.00, 6.15, 17.05, 26.40, 46.30] },
      tnt: { volumes: [0.5, 1, 5, 10, 20], prices: [5.15, 6.90, 18.45, 30.00, 51.55] },
      wurzel: { volumes: [1, 5], prices: [12.00, 56.60] },
      powerzyme: { volumes: [0.5, 1, 5], prices: [4.50, 8.50, 33.75] },
      supervit: { volumes: [0.05, 0.5], prices: [10.00, 92.10] },
      pk: { volumes: [0.5, 1, 5, 10, 20], prices: [4.00, 7.50, 28.45, 49.70, 86.65] }
    };

    const baseConsumption = {
      coco: 168,
      tnt: 61.6,
      wurzel: 61.6,
      powerzyme: 100.8,
      supervit: 0.62,
      pk: 100.8
    };

    const calculate = () => {
      const members = parseInt(document.getElementById('members').value, 10);
      if (isNaN(members) || members <= 0) {
        alert('Bitte geben Sie eine gültige Mitgliederanzahl ein.');
        return;
      }

      const results = calculateConsumption(members);
      displayRecommendations(results.recommendations);
      displaySubscriptions(results.totalCost, members);
    };

    const calculateConsumption = (members) => {
      const recommendations = {};
      let totalCost = 0;

      for (const [product, base] of Object.entries(baseConsumption)) {
        const totalVolume = (base / 500) * members;
        recommendations[product] = optimizeProduct(productData[product], totalVolume);
        totalCost += recommendations[product].totalCost;
      }

      return { recommendations, totalCost };
    };

    const optimizeProduct = (product, volume) => {
      const { volumes, prices } = product;
      let remainingVolume = volume;
      const result = { sizes: {}, totalCost: 0 };

      for (let i = volumes.length - 1; i >= 0; i--) {
        const size = volumes[i];
        const price = prices[i];
        const count = Math.floor(remainingVolume / size);

        if (count > 0) {
          result.sizes[size] = count;
          result.totalCost += count * price;
          remainingVolume -= count * size;
        }
      }

      if (remainingVolume > 0) {
        const smallestSizeIndex = 0;
        result.sizes[volumes[smallestSizeIndex]] = (result.sizes[volumes[smallestSizeIndex]] || 0) + 1;
        result.totalCost += prices[smallestSizeIndex];
      }

      return result;
    };

    const displayRecommendations = (recommendations) => {
      const tableBody = document.querySelector('#recommendations-table tbody');
      tableBody.innerHTML = '';

      for (const [product, data] of Object.entries(recommendations)) {
        for (const [size, count] of Object.entries(data.sizes)) {
          const row = `
            <tr>
              <td>${product}</td>
              <td>${size} L</td>
              <td>${count}</td>
              <td>${productData[product].prices[productData[product].volumes.indexOf(parseFloat(size))].toFixed(2)}</td>
              <td>${(count * productData[product].prices[productData[product].volumes.indexOf(parseFloat(size))]).toFixed(2)}</td>
            </tr>
          `;
          tableBody.insertAdjacentHTML('beforeend', row);
        }
      }
    };

    const displaySubscriptions = (totalCost, members) => {
      const avgYield = 66.96; // grams per plant
      const tableBody = document.querySelector('#subscription-table tbody');
      tableBody.innerHTML = '';

      const plans = [
        { name: 'Small (10 Wochen)', discount: 0.0196 },
        { name: 'Medium (20 Wochen)', discount: 0.0667 },
        { name: 'Large (40 Wochen)', discount: 0.1382 }
      ];

      plans.forEach(plan => {
        const discountedCost = totalCost * (1 - plan.discount);
        const costPerGram = discountedCost / (members * avgYield);
        const costPerPlant = discountedCost / members;
        const monthlyCost = discountedCost / (10 / 4); // 10 weeks = ~2.5 months

        const row = `
          <tr>
            <td>${plan.name}</td>
            <td>${discountedCost.toFixed(2)}</td>
            <td>${costPerGram.toFixed(2)}</td>
            <td>${costPerPlant.toFixed(2)}</td>
            <td>${monthlyCost.toFixed(2)}</td>
          </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', row);
      });
    };
  </script>
</body>
</html>
